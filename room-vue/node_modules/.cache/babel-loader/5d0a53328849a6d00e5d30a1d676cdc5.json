{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport axios from 'axios';\nimport router from \"@/router\";\nimport { Message } from \"element-ui\";\nconst request = axios.create({\n  baseURL: process.env.VUE_APP_API_BASE_URL || 'http://localhost:8080',\n  timeout: 5000\n}); // 登录流程控制中，根据本地是否存在token判断用户的登录情况\n// 但是即使token存在，也有可能token是过期的，所以在每次的请求头中携带token\n// 后台根据携带的token判断用户的登录情况，并返回给我们对应的状态码\n// 而后我们可以在响应拦截器中，根据状态码进行一些统一的操作。\n// 请求拦截器\n\nrequest.interceptors.request.use(config => {\n  const token = localStorage.getItem('token');\n\n  if (token) {\n    config.headers.Authorization = `Bearer ${token}`;\n  }\n\n  return config;\n}, error => {\n  console.error('Request error:', error);\n  return Promise.reject(error);\n}); // 响应拦截器\n\nrequest.interceptors.response.use(response => {\n  return response.data;\n}, error => {\n  if (error.response && error.response.status === 401) {\n    localStorage.removeItem('token');\n    localStorage.removeItem('user');\n    localStorage.removeItem('role');\n    import('@/views/login/login.vue').then(() => {\n      // 使用路由跳转到登录页\n      if (router.currentRoute.path !== '/login') {\n        router.push('/login');\n      }\n    });\n  } else if (error.response && error.response.status === 403) {\n    console.error('Forbidden: No permission');\n  }\n\n  return Promise.reject(error);\n});\nexport default request;","map":{"version":3,"names":["axios","router","Message","request","create","baseURL","process","env","VUE_APP_API_BASE_URL","timeout","interceptors","use","config","token","localStorage","getItem","headers","Authorization","error","console","Promise","reject","response","data","status","removeItem","then","currentRoute","path","push"],"sources":["C:/Users/86138/Desktop/软件/room/room-vue/src/utils/request.js"],"sourcesContent":["import axios from 'axios'\r\nimport router from \"@/router\";\r\nimport {Message} from \"element-ui\";\r\n\r\nconst request = axios.create({\r\n    baseURL: process.env.VUE_APP_API_BASE_URL || 'http://localhost:8080',\r\n    timeout: 5000\r\n})\r\n\r\n// 登录流程控制中，根据本地是否存在token判断用户的登录情况\r\n// 但是即使token存在，也有可能token是过期的，所以在每次的请求头中携带token\r\n// 后台根据携带的token判断用户的登录情况，并返回给我们对应的状态码\r\n// 而后我们可以在响应拦截器中，根据状态码进行一些统一的操作。\r\n// 请求拦截器\r\nrequest.interceptors.request.use(\r\n    config => {\r\n        const token = localStorage.getItem('token');\r\n        if (token) {\r\n            config.headers.Authorization = `Bearer ${token}`;\r\n        }\r\n        return config;\r\n    },\r\n    error => {\r\n        console.error('Request error:', error);\r\n        return Promise.reject(error);\r\n    }\r\n);\r\n\r\n// 响应拦截器\r\nrequest.interceptors.response.use(response => {\r\n    return response.data;\r\n}, error => {\r\n    if (error.response && error.response.status === 401) {\r\n        localStorage.removeItem('token');\r\n        localStorage.removeItem('user');\r\n        localStorage.removeItem('role');\r\n        import('@/views/login/login.vue').then(() => {\r\n            // 使用路由跳转到登录页\r\n            if (router.currentRoute.path !== '/login') {\r\n                router.push('/login');\r\n            }\r\n        });\r\n    } else if (error.response && error.response.status === 403) {\r\n        console.error('Forbidden: No permission');\r\n    }\r\n    return Promise.reject(error);\r\n});\r\n\r\n\r\nexport default request"],"mappings":";AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAOC,MAAP,MAAmB,UAAnB;AACA,SAAQC,OAAR,QAAsB,YAAtB;AAEA,MAAMC,OAAO,GAAGH,KAAK,CAACI,MAAN,CAAa;EACzBC,OAAO,EAAEC,OAAO,CAACC,GAAR,CAAYC,oBAAZ,IAAoC,uBADpB;EAEzBC,OAAO,EAAE;AAFgB,CAAb,CAAhB,C,CAKA;AACA;AACA;AACA;AACA;;AACAN,OAAO,CAACO,YAAR,CAAqBP,OAArB,CAA6BQ,GAA7B,CACIC,MAAM,IAAI;EACN,MAAMC,KAAK,GAAGC,YAAY,CAACC,OAAb,CAAqB,OAArB,CAAd;;EACA,IAAIF,KAAJ,EAAW;IACPD,MAAM,CAACI,OAAP,CAAeC,aAAf,GAAgC,UAASJ,KAAM,EAA/C;EACH;;EACD,OAAOD,MAAP;AACH,CAPL,EAQIM,KAAK,IAAI;EACLC,OAAO,CAACD,KAAR,CAAc,gBAAd,EAAgCA,KAAhC;EACA,OAAOE,OAAO,CAACC,MAAR,CAAeH,KAAf,CAAP;AACH,CAXL,E,CAcA;;AACAf,OAAO,CAACO,YAAR,CAAqBY,QAArB,CAA8BX,GAA9B,CAAkCW,QAAQ,IAAI;EAC1C,OAAOA,QAAQ,CAACC,IAAhB;AACH,CAFD,EAEGL,KAAK,IAAI;EACR,IAAIA,KAAK,CAACI,QAAN,IAAkBJ,KAAK,CAACI,QAAN,CAAeE,MAAf,KAA0B,GAAhD,EAAqD;IACjDV,YAAY,CAACW,UAAb,CAAwB,OAAxB;IACAX,YAAY,CAACW,UAAb,CAAwB,MAAxB;IACAX,YAAY,CAACW,UAAb,CAAwB,MAAxB;IACA,OAAO,yBAAP,EAAkCC,IAAlC,CAAuC,MAAM;MACzC;MACA,IAAIzB,MAAM,CAAC0B,YAAP,CAAoBC,IAApB,KAA6B,QAAjC,EAA2C;QACvC3B,MAAM,CAAC4B,IAAP,CAAY,QAAZ;MACH;IACJ,CALD;EAMH,CAVD,MAUO,IAAIX,KAAK,CAACI,QAAN,IAAkBJ,KAAK,CAACI,QAAN,CAAeE,MAAf,KAA0B,GAAhD,EAAqD;IACxDL,OAAO,CAACD,KAAR,CAAc,0BAAd;EACH;;EACD,OAAOE,OAAO,CAACC,MAAR,CAAeH,KAAf,CAAP;AACH,CAjBD;AAoBA,eAAef,OAAf"},"metadata":{},"sourceType":"module"}