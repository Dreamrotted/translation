{"ast":null,"code":"import request from \"@/utils/request\";\nimport { formatDateTime } from \"@/utils/dateUtil\";\nexport default {\n  data() {\n    return {\n      dataList: [],\n      current: 1,\n      pageSize: 10,\n      totalPage: 0,\n      dataListLoading: false,\n      query: {\n        studentNumber: '',\n        status: null\n      },\n      addDialogVisible: false,\n      addForm: {\n        studentNumber: null,\n        reason: '',\n        days: 7\n      },\n      addFormRules: {\n        studentNumber: [{\n          required: true,\n          message: '请输入学号',\n          trigger: 'blur'\n        }],\n        reason: [{\n          required: true,\n          message: '请输入原因',\n          trigger: 'blur'\n        }],\n        days: [{\n          required: true,\n          message: '请输入期限',\n          trigger: 'blur'\n        }]\n      },\n      studentInfo: {},\n      violationCount: 0\n    };\n  },\n\n  methods: {\n    getDataList() {\n      this.dataListLoading = true;\n      const params = {\n        pageNum: this.current,\n        pageSize: this.pageSize\n      };\n\n      if (this.query.studentNumber) {\n        params.studentNumber = this.query.studentNumber;\n      }\n\n      if (this.query.status !== null && this.query.status !== '') {\n        params.status = this.query.status;\n      }\n\n      request.get('/blacklist/page', {\n        params\n      }).then(resp => {\n        if (resp.code === 200) {\n          this.dataList = resp.data.list;\n          this.totalPage = resp.data.total;\n        } else {\n          this.dataList = [];\n          this.$message.error(resp.message || '获取数据失败');\n        }\n\n        this.dataListLoading = false;\n      }).catch(err => {\n        console.error('获取黑名单错误:', err);\n        this.dataList = [];\n        this.dataListLoading = false;\n        this.$message.error('获取数据失败，请稍后重试');\n      });\n    },\n\n    resetSearch() {\n      this.query = {\n        studentNumber: '',\n        status: null\n      };\n      this.current = 1;\n      this.getDataList();\n    },\n\n    sizeChangeHandle(val) {\n      this.pageSize = val;\n      this.current = 1;\n      this.getDataList();\n    },\n\n    currentChangeHandle(val) {\n      this.current = val;\n      this.getDataList();\n    },\n\n    handleAdd() {\n      this.addDialogVisible = true;\n    },\n\n    getStudentInfo() {\n      if (this.addForm.studentNumber) {\n        request.get('/student/getByNumber', {\n          params: {\n            studentNumber: this.addForm.studentNumber\n          }\n        }).then(resp => {\n          if (resp.code === 200 && resp.data) {\n            this.studentInfo = resp.data; // 获取违规次数\n\n            this.getViolationCount(resp.data.id);\n          } else {\n            this.studentInfo = {};\n            this.violationCount = 0;\n            this.$message.warning('未找到该学生');\n          }\n        });\n      }\n    },\n\n    getViolationCount(studentId) {\n      request.get(`/violation/monthCount/${studentId}`).then(resp => {\n        if (resp.code === 200) {\n          this.violationCount = resp.data;\n        } else {\n          this.violationCount = 0;\n        }\n      }).catch(() => {\n        this.violationCount = 0;\n      });\n    },\n\n    submitAdd() {\n      this.$refs.addForm.validate(valid => {\n        if (valid) {\n          // 计算结束时间\n          const endTime = new Date();\n          endTime.setDate(endTime.getDate() + this.addForm.days);\n          request.post('/blacklist/add', {\n            studentId: this.studentInfo.id,\n            reason: this.addForm.reason,\n            endTime: formatDateTime(endTime),\n            adminId: JSON.parse(localStorage.getItem(\"user\")).id\n          }).then(resp => {\n            if (resp.code === 200) {\n              this.$message.success('添加成功');\n              this.addDialogVisible = false;\n              this.getDataList();\n            } else {\n              this.$message.error(resp.message || '添加失败');\n            }\n          });\n        }\n      });\n    },\n\n    resetAddForm() {\n      this.$refs.addForm.resetFields();\n      this.studentInfo = {};\n      this.violationCount = 0;\n    },\n\n    handleRemove(id) {\n      this.$confirm('确认解除该学生的黑名单?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(() => {\n        request.put(`/blacklist/remove/${id}`).then(resp => {\n          if (resp.code === 200) {\n            this.$message.success('解除成功');\n            this.getDataList();\n          } else {\n            this.$message.error(resp.message || '解除失败');\n          }\n        });\n      }).catch(() => {});\n    },\n\n    handleDelete(id) {\n      this.$confirm('确认删除该记录?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(() => {\n        request.delete(`/blacklist/delete/${id}`).then(resp => {\n          if (resp.code === 200) {\n            this.$message.success('删除成功');\n            this.getDataList();\n          } else {\n            this.$message.error(resp.message || '删除失败');\n          }\n        });\n      }).catch(() => {});\n    }\n\n  },\n\n  created() {\n    this.getDataList();\n  }\n\n};","map":{"version":3,"mappings":"AAyFA;AACA;AAEA;EACAA;IACA;MACAC,YADA;MAEAC,UAFA;MAGAC,YAHA;MAIAC,YAJA;MAKAC,sBALA;MAMAC;QACAC,iBADA;QAEAC;MAFA,CANA;MAUAC,uBAVA;MAWAC;QACAH,mBADA;QAEAI,UAFA;QAGAC;MAHA,CAXA;MAgBAC;QACAN;UAAAO;UAAAC;UAAAC;QAAA,EADA;QAEAL;UAAAG;UAAAC;UAAAC;QAAA,EAFA;QAGAJ;UAAAE;UAAAC;UAAAC;QAAA;MAHA,CAhBA;MAqBAC,eArBA;MAsBAC;IAtBA;EAwBA,CA1BA;;EA2BAC;IACAC;MACA;MACA;QACAC,qBADA;QAEAlB;MAFA;;MAKA;QACAmB;MACA;;MACA;QACAA;MACA;;MAEAC;QAAAD;MAAA;QACA;UACA;UACA;QACA,CAHA,MAGA;UACA;UACA;QACA;;QACA;MACA,CATA,EASAE,KATA,CASAC;QACAC;QACA;QACA;QACA;MACA,CAdA;IAeA,CA9BA;;IA+BAC;MACA;QACApB,iBADA;QAEAC;MAFA;MAIA;MACA;IACA,CAtCA;;IAuCAoB;MACA;MACA;MACA;IACA,CA3CA;;IA4CAC;MACA;MACA;IACA,CA/CA;;IAgDAC;MACA;IACA,CAlDA;;IAmDAC;MACA;QACAR;UACAD;YAAAf;UAAA;QADA,GAEAyB,IAFA,CAEAC;UACA;YACA,6BADA,CAEA;;YACA;UACA,CAJA,MAIA;YACA;YACA;YACA;UACA;QACA,CAZA;MAaA;IACA,CAnEA;;IAoEAC;MACAX;QACA;UACA;QACA,CAFA,MAEA;UACA;QACA;MACA,CANA,EAMAC,KANA,CAMA;QACA;MACA,CARA;IASA,CA9EA;;IA+EAW;MACA;QACA;UACA;UACA;UACAC;UAEAb;YACAc,8BADA;YAEA1B,2BAFA;YAGAyB,gCAHA;YAIAE;UAJA,GAKAN,IALA,CAKAC;YACA;cACA;cACA;cACA;YACA,CAJA,MAIA;cACA;YACA;UACA,CAbA;QAcA;MACA,CArBA;IAsBA,CAtGA;;IAuGAM;MACA;MACA;MACA;IACA,CA3GA;;IA4GAC;MACA;QACAC,uBADA;QAEAC,sBAFA;QAGAC;MAHA,GAIAX,IAJA,CAIA;QACAT;UACA;YACA;YACA;UACA,CAHA,MAGA;YACA;UACA;QACA,CAPA;MAQA,CAbA,EAaAC,KAbA,CAaA,QAbA;IAcA,CA3HA;;IA4HAoB;MACA;QACAH,uBADA;QAEAC,sBAFA;QAGAC;MAHA,GAIAX,IAJA,CAIA;QACAT;UACA;YACA;YACA;UACA,CAHA,MAGA;YACA;UACA;QACA,CAPA;MAQA,CAbA,EAaAC,KAbA,CAaA,QAbA;IAcA;;EA3IA,CA3BA;;EAwKAqB;IACA;EACA;;AA1KA","names":["data","dataList","current","pageSize","totalPage","dataListLoading","query","studentNumber","status","addDialogVisible","addForm","reason","days","addFormRules","required","message","trigger","studentInfo","violationCount","methods","getDataList","pageNum","params","request","catch","err","console","resetSearch","sizeChangeHandle","currentChangeHandle","handleAdd","getStudentInfo","then","resp","getViolationCount","submitAdd","endTime","studentId","adminId","resetAddForm","handleRemove","confirmButtonText","cancelButtonText","type","handleDelete","created"],"sourceRoot":"src/views/admin","sources":["blacklist.vue"],"sourcesContent":["<!--管理员黑名单管理-->\r\n<template>\r\n  <div class=\"container\">\r\n    <!--条件查询-->\r\n    <div class=\"search-bar\">\r\n      <el-input v-model=\"query.studentNumber\" placeholder=\"学号\" style=\"width: 150px;\"\r\n                @keyup.enter.native=\"getDataList\"></el-input>\r\n      <el-select v-model=\"query.status\" placeholder=\"状态\" style=\"width: 150px; margin-left: 10px;\" clearable>\r\n        <el-option label=\"生效中\" :value=\"1\"></el-option>\r\n        <el-option label=\"已解除\" :value=\"0\"></el-option>\r\n      </el-select>\r\n      <el-button type=\"primary\" icon=\"el-icon-search\" @click=\"getDataList\" style=\"margin-left: 10px\">搜索</el-button>\r\n      <el-button icon=\"el-icon-refresh\" @click=\"resetSearch\" style=\"margin-left: 10px\">重置</el-button>\r\n      <el-button type=\"danger\" icon=\"el-icon-plus\" @click=\"handleAdd\" style=\"margin-left: 10px\">手动加入黑名单</el-button>\r\n    </div>\r\n\r\n    <el-table :data=\"dataList\"\r\n              border\r\n              stripe\r\n              v-loading=\"dataListLoading\"\r\n              highlight-current-row>\r\n      <el-table-column type=\"index\" min-width=\"60\" header-align=\"center\" align=\"center\" label=\"序号\"></el-table-column>\r\n      <el-table-column prop=\"student.studentName\" header-align=\"center\" align=\"center\" min-width=\"100\" label=\"姓名\"></el-table-column>\r\n      <el-table-column prop=\"student.studentNumber\" header-align=\"center\" align=\"center\" min-width=\"100\" label=\"学号\"></el-table-column>\r\n      <el-table-column prop=\"student.majorName\" header-align=\"center\" align=\"center\" min-width=\"150\" label=\"专业\"></el-table-column>\r\n      <el-table-column prop=\"reason\" header-align=\"center\" align=\"center\" min-width=\"200\" label=\"原因\"></el-table-column>\r\n      <el-table-column prop=\"startTime\" header-align=\"center\" align=\"center\" min-width=\"160\" label=\"开始时间\"></el-table-column>\r\n      <el-table-column prop=\"endTime\" header-align=\"center\" align=\"center\" min-width=\"160\" label=\"结束时间\"></el-table-column>\r\n      <el-table-column prop=\"addType\" header-align=\"center\" align=\"center\" min-width=\"100\" label=\"加入方式\">\r\n        <template v-slot=\"scope\">\r\n          <el-tag v-if=\"scope.row.addType === 0\" type=\"warning\">系统自动</el-tag>\r\n          <el-tag v-else type=\"primary\">管理员手动</el-tag>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column prop=\"status\" header-align=\"center\" align=\"center\" min-width=\"100\" label=\"状态\">\r\n        <template v-slot=\"scope\">\r\n          <el-tag v-if=\"scope.row.status === 1\" type=\"danger\">生效中</el-tag>\r\n          <el-tag v-else type=\"success\">已解除</el-tag>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column fixed=\"right\" header-align=\"center\" align=\"center\" width=\"150\" label=\"操作\">\r\n        <template v-slot=\"scope\">\r\n          <el-button type=\"success\" size=\"small\" @click=\"handleRemove(scope.row.id)\" v-if=\"scope.row.status === 1\">\r\n            解除\r\n          </el-button>\r\n          <el-button type=\"danger\" size=\"small\" @click=\"handleDelete(scope.row.id)\">删除</el-button>\r\n        </template>\r\n      </el-table-column>\r\n    </el-table>\r\n\r\n    <el-pagination\r\n        @size-change=\"sizeChangeHandle\"\r\n        @current-change=\"currentChangeHandle\"\r\n        :current-page=\"current\"\r\n        :page-sizes=\"[10, 20, 50, 100]\"\r\n        :page-size=\"pageSize\"\r\n        :total=\"totalPage\"\r\n        layout=\"total, sizes, prev, pager, next, jumper\">\r\n    </el-pagination>\r\n\r\n    <!-- 添加黑名单对话框 -->\r\n    <el-dialog title=\"手动加入黑名单\" :visible.sync=\"addDialogVisible\" width=\"500px\" @close=\"resetAddForm\">\r\n      <el-form :model=\"addForm\" :rules=\"addFormRules\" ref=\"addForm\" label-width=\"100px\">\r\n        <el-form-item label=\"学号\" prop=\"studentNumber\">\r\n          <el-input v-model.number=\"addForm.studentNumber\" placeholder=\"请输入学号\" @blur=\"getStudentInfo\"></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"学生姓名\" v-if=\"studentInfo.studentName\">\r\n          <el-input v-model=\"studentInfo.studentName\" disabled></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"违规次数\" v-if=\"studentInfo.id\">\r\n          <el-tag type=\"warning\">本月违规 {{ violationCount }} 次</el-tag>\r\n        </el-form-item>\r\n        <el-form-item label=\"原因\" prop=\"reason\">\r\n          <el-input type=\"textarea\" v-model=\"addForm.reason\" placeholder=\"请输入加入黑名单的原因\" :rows=\"3\"></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"期限(天)\" prop=\"days\">\r\n          <el-input-number v-model=\"addForm.days\" :min=\"1\" :max=\"30\" placeholder=\"黑名单期限\"></el-input-number>\r\n          <span style=\"margin-left: 10px; color: #999;\">默认7天</span>\r\n        </el-form-item>\r\n      </el-form>\r\n      <div slot=\"footer\">\r\n        <el-button @click=\"addDialogVisible = false\">取消</el-button>\r\n        <el-button type=\"primary\" @click=\"submitAdd\">确定</el-button>\r\n      </div>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport request from \"@/utils/request\";\r\nimport { formatDateTime } from \"@/utils/dateUtil\";\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      dataList: [],\r\n      current: 1,\r\n      pageSize: 10,\r\n      totalPage: 0,\r\n      dataListLoading: false,\r\n      query: {\r\n        studentNumber: '',\r\n        status: null\r\n      },\r\n      addDialogVisible: false,\r\n      addForm: {\r\n        studentNumber: null,\r\n        reason: '',\r\n        days: 7\r\n      },\r\n      addFormRules: {\r\n        studentNumber: [{required: true, message: '请输入学号', trigger: 'blur'}],\r\n        reason: [{required: true, message: '请输入原因', trigger: 'blur'}],\r\n        days: [{required: true, message: '请输入期限', trigger: 'blur'}]\r\n      },\r\n      studentInfo: {},\r\n      violationCount: 0\r\n    };\r\n  },\r\n  methods: {\r\n    getDataList() {\r\n      this.dataListLoading = true;\r\n      const params = {\r\n        pageNum: this.current,\r\n        pageSize: this.pageSize,\r\n      };\r\n\r\n      if (this.query.studentNumber) {\r\n        params.studentNumber = this.query.studentNumber;\r\n      }\r\n      if (this.query.status !== null && this.query.status !== '') {\r\n        params.status = this.query.status;\r\n      }\r\n\r\n      request.get('/blacklist/page', {params}).then((resp) => {\r\n        if (resp.code === 200) {\r\n          this.dataList = resp.data.list;\r\n          this.totalPage = resp.data.total;\r\n        } else {\r\n          this.dataList = [];\r\n          this.$message.error(resp.message || '获取数据失败');\r\n        }\r\n        this.dataListLoading = false;\r\n      }).catch(err => {\r\n        console.error('获取黑名单错误:', err);\r\n        this.dataList = [];\r\n        this.dataListLoading = false;\r\n        this.$message.error('获取数据失败，请稍后重试');\r\n      });\r\n    },\r\n    resetSearch() {\r\n      this.query = {\r\n        studentNumber: '',\r\n        status: null\r\n      };\r\n      this.current = 1;\r\n      this.getDataList();\r\n    },\r\n    sizeChangeHandle(val) {\r\n      this.pageSize = val;\r\n      this.current = 1;\r\n      this.getDataList();\r\n    },\r\n    currentChangeHandle(val) {\r\n      this.current = val;\r\n      this.getDataList();\r\n    },\r\n    handleAdd() {\r\n      this.addDialogVisible = true;\r\n    },\r\n    getStudentInfo() {\r\n      if (this.addForm.studentNumber) {\r\n        request.get('/student/getByNumber', {\r\n          params: {studentNumber: this.addForm.studentNumber}\r\n        }).then(resp => {\r\n          if (resp.code === 200 && resp.data) {\r\n            this.studentInfo = resp.data;\r\n            // 获取违规次数\r\n            this.getViolationCount(resp.data.id);\r\n          } else {\r\n            this.studentInfo = {};\r\n            this.violationCount = 0;\r\n            this.$message.warning('未找到该学生');\r\n          }\r\n        });\r\n      }\r\n    },\r\n    getViolationCount(studentId) {\r\n      request.get(`/violation/monthCount/${studentId}`).then(resp => {\r\n        if (resp.code === 200) {\r\n          this.violationCount = resp.data;\r\n        } else {\r\n          this.violationCount = 0;\r\n        }\r\n      }).catch(() => {\r\n        this.violationCount = 0;\r\n      });\r\n    },\r\n    submitAdd() {\r\n      this.$refs.addForm.validate(valid => {\r\n        if (valid) {\r\n          // 计算结束时间\r\n          const endTime = new Date();\r\n          endTime.setDate(endTime.getDate() + this.addForm.days);\r\n          \r\n          request.post('/blacklist/add', {\r\n            studentId: this.studentInfo.id,\r\n            reason: this.addForm.reason,\r\n            endTime: formatDateTime(endTime),\r\n            adminId: JSON.parse(localStorage.getItem(\"user\")).id\r\n          }).then(resp => {\r\n            if (resp.code === 200) {\r\n              this.$message.success('添加成功');\r\n              this.addDialogVisible = false;\r\n              this.getDataList();\r\n            } else {\r\n              this.$message.error(resp.message || '添加失败');\r\n            }\r\n          });\r\n        }\r\n      });\r\n    },\r\n    resetAddForm() {\r\n      this.$refs.addForm.resetFields();\r\n      this.studentInfo = {};\r\n      this.violationCount = 0;\r\n    },\r\n    handleRemove(id) {\r\n      this.$confirm('确认解除该学生的黑名单?', '提示', {\r\n        confirmButtonText: '确定',\r\n        cancelButtonText: '取消',\r\n        type: 'warning'\r\n      }).then(() => {\r\n        request.put(`/blacklist/remove/${id}`).then(resp => {\r\n          if (resp.code === 200) {\r\n            this.$message.success('解除成功');\r\n            this.getDataList();\r\n          } else {\r\n            this.$message.error(resp.message || '解除失败');\r\n          }\r\n        });\r\n      }).catch(() => {});\r\n    },\r\n    handleDelete(id) {\r\n      this.$confirm('确认删除该记录?', '提示', {\r\n        confirmButtonText: '确定',\r\n        cancelButtonText: '取消',\r\n        type: 'warning'\r\n      }).then(() => {\r\n        request.delete(`/blacklist/delete/${id}`).then(resp => {\r\n          if (resp.code === 200) {\r\n            this.$message.success('删除成功');\r\n            this.getDataList();\r\n          } else {\r\n            this.$message.error(resp.message || '删除失败');\r\n          }\r\n        });\r\n      }).catch(() => {});\r\n    }\r\n  },\r\n  created() {\r\n    this.getDataList();\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.container {\r\n  padding: 20px;\r\n}\r\n\r\n.search-bar {\r\n  margin-bottom: 20px;\r\n}\r\n</style>\r\n"]},"metadata":{},"sourceType":"module"}