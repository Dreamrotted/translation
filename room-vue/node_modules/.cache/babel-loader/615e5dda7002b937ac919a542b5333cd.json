{"ast":null,"code":"import \"core-js/modules/es.error.cause.js\";\nimport \"core-js/modules/es.array.push.js\";\nimport request from \"@/utils/request\";\nexport default {\n  data() {\n    // 自定义验证规则 - 确认密码\n    const validateConfirmPassword = (rule, value, callback) => {\n      if (value === '') {\n        callback(new Error('请再次输入密码'));\n      } else if (value !== this.passwordForm.newPassword) {\n        callback(new Error('两次输入密码不一致!'));\n      } else {\n        callback();\n      }\n    };\n\n    return {\n      ruleForm: {\n        id: null,\n        studentNumber: '',\n        studentName: '',\n        gender: 1,\n        majorName: ''\n      },\n      rules: {\n        studentNumber: [{\n          required: true,\n          message: '请输入学号',\n          trigger: 'blur'\n        }],\n        studentName: [{\n          required: true,\n          message: '请输入姓名',\n          trigger: 'blur'\n        }],\n        gender: [{\n          required: true,\n          message: '请选择性别',\n          trigger: 'change'\n        }],\n        majorName: [{\n          required: true,\n          message: '请输入专业',\n          trigger: 'blur'\n        }]\n      },\n      passwordForm: {\n        oldPassword: '',\n        newPassword: '',\n        confirmPassword: ''\n      },\n      passwordRules: {\n        oldPassword: [{\n          required: true,\n          message: '请输入原密码',\n          trigger: 'blur'\n        }],\n        newPassword: [{\n          required: true,\n          message: '请输入新密码',\n          trigger: 'blur'\n        }, {\n          min: 6,\n          message: '密码长度不能少于6位',\n          trigger: 'blur'\n        }],\n        confirmPassword: [{\n          required: true,\n          message: '请再次输入密码',\n          trigger: 'blur'\n        }, {\n          validator: validateConfirmPassword,\n          trigger: 'blur'\n        }]\n      },\n      isEditing: false,\n      originalData: {} // 保存原始数据\n\n    };\n  },\n\n  created() {\n    this.fetchStudentInfo();\n  },\n\n  methods: {\n    fetchStudentInfo() {\n      const studentId = JSON.parse(localStorage.getItem(\"user\")).id;\n      request.get(`/student/${studentId}`).then(res => {\n        if (res.code === 200) {\n          // 不包含密码字段\n          this.ruleForm = {\n            id: res.data.id,\n            studentNumber: res.data.studentNumber,\n            studentName: res.data.studentName,\n            gender: res.data.gender,\n            majorName: res.data.majorName\n          };\n          this.originalData = { ...this.ruleForm\n          }; // 保存原始数据\n        } else {\n          this.$message.error(res.message || '获取信息失败');\n        }\n      }).catch(err => {\n        console.error('获取学生信息错误:', err);\n        this.$message.error('获取信息失败');\n      });\n    },\n\n    toggleEdit() {\n      this.isEditing = true;\n    },\n\n    saveInfo() {\n      this.$refs.ruleForm.validate(valid => {\n        if (valid) {\n          // 只提交基本信息，不包含密码\n          request.put('/student/updateInfo', this.ruleForm).then(res => {\n            if (res.code === 200) {\n              this.$notify.success('修改成功');\n              this.isEditing = false;\n              this.originalData = { ...this.ruleForm\n              }; // 更新 localStorage 中的用户信息\n\n              const user = JSON.parse(localStorage.getItem(\"user\"));\n              user.studentName = this.ruleForm.studentName;\n              user.majorName = this.ruleForm.majorName;\n              localStorage.setItem(\"user\", JSON.stringify(user));\n            } else {\n              this.$notify.error(res.message || '修改失败');\n            }\n          }).catch(err => {\n            console.error('修改信息错误:', err);\n            this.$notify.error('修改失败');\n          });\n        }\n      });\n    },\n\n    cancel() {\n      this.isEditing = false;\n      this.ruleForm = { ...this.originalData\n      }; // 恢复原始数据\n\n      this.$refs.ruleForm.clearValidate();\n    },\n\n    changePassword() {\n      this.$refs.passwordForm.validate(valid => {\n        if (valid) {\n          const studentId = JSON.parse(localStorage.getItem(\"user\")).id;\n          request.put('/student/changePassword', {\n            studentId: studentId,\n            oldPassword: this.passwordForm.oldPassword,\n            newPassword: this.passwordForm.newPassword\n          }).then(res => {\n            if (res.code === 200) {\n              this.$notify.success('密码修改成功，请重新登录');\n              this.resetPasswordForm(); // 3秒后跳转到登录页\n\n              setTimeout(() => {\n                localStorage.clear();\n                this.$router.push('/login');\n              }, 3000);\n            } else {\n              this.$notify.error(res.message || '密码修改失败');\n            }\n          }).catch(err => {\n            console.error('修改密码错误:', err);\n            this.$notify.error('修改密码失败');\n          });\n        }\n      });\n    },\n\n    resetPasswordForm() {\n      this.passwordForm = {\n        oldPassword: '',\n        newPassword: '',\n        confirmPassword: ''\n      };\n      this.$refs.passwordForm.clearValidate();\n    }\n\n  }\n};","map":{"version":3,"mappings":";;AA8DA;AAEA;EACAA;IACA;IACA;MACA;QACAC;MACA,CAFA,MAEA;QACAA;MACA,CAFA,MAEA;QACAA;MACA;IACA,CARA;;IAUA;MACAC;QACAC,QADA;QAEAC,iBAFA;QAGAC,eAHA;QAIAC,SAJA;QAKAC;MALA,CADA;MAQAC;QACAJ;UAAAK;UAAAC;UAAAC;QAAA,EADA;QAEAN;UAAAI;UAAAC;UAAAC;QAAA,EAFA;QAGAL;UAAAG;UAAAC;UAAAC;QAAA,EAHA;QAIAJ;UAAAE;UAAAC;UAAAC;QAAA;MAJA,CARA;MAcAC;QACAC,eADA;QAEAC,eAFA;QAGAC;MAHA,CAdA;MAmBAC;QACAH;UAAAJ;UAAAC;UAAAC;QAAA,EADA;QAEAG,cACA;UAAAL;UAAAC;UAAAC;QAAA,CADA,EAEA;UAAAM;UAAAP;UAAAC;QAAA,CAFA,CAFA;QAMAI,kBACA;UAAAN;UAAAC;UAAAC;QAAA,CADA,EAEA;UAAAO;UAAAP;QAAA,CAFA;MANA,CAnBA;MA8BAQ,gBA9BA;MA+BAC,gBA/BA,CA+BA;;IA/BA;EAiCA,CA9CA;;EA+CAC;IACA;EACA,CAjDA;;EAkDAC;IACAC;MACA;MACAC;QACA;UACA;UACA;YACArB,eADA;YAEAC,qCAFA;YAGAC,iCAHA;YAIAC,uBAJA;YAKAC;UALA;UAOA;UAAA,EATA,CASA;QACA,CAVA,MAUA;UACA;QACA;MACA,CAdA,EAcAkB,KAdA,CAcAC;QACAC;QACA;MACA,CAjBA;IAkBA,CArBA;;IAsBAC;MACA;IACA,CAxBA;;IAyBAC;MACA;QACA;UACA;UACAL;YACA;cACA;cACA;cACA;cAAA,EAHA,CAIA;;cACA;cACAM;cACAA;cACAC;YACA,CATA,MASA;cACA;YACA;UACA,CAbA,EAaAN,KAbA,CAaAC;YACAC;YACA;UACA,CAhBA;QAiBA;MACA,CArBA;IAsBA,CAhDA;;IAiDAK;MACA;MACA;MAAA,EAFA,CAEA;;MACA;IACA,CArDA;;IAsDAC;MACA;QACA;UACA;UACAT;YACAU,oBADA;YAEArB,0CAFA;YAGAC;UAHA,GAIAqB,IAJA,CAIAC;YACA;cACA;cACA,yBAFA,CAGA;;cACAC;gBACAN;gBACA;cACA,CAHA,EAGA,IAHA;YAIA,CARA,MAQA;cACA;YACA;UACA,CAhBA,EAgBAN,KAhBA,CAgBAC;YACAC;YACA;UACA,CAnBA;QAoBA;MACA,CAxBA;IAyBA,CAhFA;;IAiFAW;MACA;QACAzB,eADA;QAEAC,eAFA;QAGAC;MAHA;MAKA;IACA;;EAxFA;AAlDA","names":["data","callback","ruleForm","id","studentNumber","studentName","gender","majorName","rules","required","message","trigger","passwordForm","oldPassword","newPassword","confirmPassword","passwordRules","min","validator","isEditing","originalData","created","methods","fetchStudentInfo","request","catch","err","console","toggleEdit","saveInfo","user","localStorage","cancel","changePassword","studentId","then","res","setTimeout","resetPasswordForm"],"sourceRoot":"src/views/student","sources":["studentInfo.vue"],"sourcesContent":["<template>\r\n  <div class=\"container\">\r\n    <el-row :gutter=\"20\">\r\n      <!-- 左侧：个人信息 -->\r\n      <el-col :xs=\"24\" :sm=\"24\" :md=\"12\">\r\n        <el-card class=\"info-card\">\r\n          <div slot=\"header\" class=\"clearfix\">\r\n            <span style=\"font-size: 18px; font-weight: bold;\">个人信息</span>\r\n          </div>\r\n          <el-form :model=\"ruleForm\" :rules=\"rules\" ref=\"ruleForm\" label-width=\"100px\" class=\"demo-ruleForm\">\r\n            <el-form-item label=\"学号\" prop=\"studentNumber\">\r\n              <el-input v-model=\"ruleForm.studentNumber\" :disabled=\"!isEditing\"></el-input>\r\n            </el-form-item>\r\n            <el-form-item label=\"姓名\" prop=\"studentName\">\r\n              <el-input v-model=\"ruleForm.studentName\" :disabled=\"!isEditing\"></el-input>\r\n            </el-form-item>\r\n            <el-form-item label=\"性别\" prop=\"gender\">\r\n              <el-radio-group v-model=\"ruleForm.gender\" :disabled=\"!isEditing\">\r\n                <el-radio :label=\"1\">男</el-radio>\r\n                <el-radio :label=\"0\">女</el-radio>\r\n              </el-radio-group>\r\n            </el-form-item>\r\n            <el-form-item label=\"专业\" prop=\"majorName\">\r\n              <el-input v-model=\"ruleForm.majorName\" :disabled=\"!isEditing\"></el-input>\r\n            </el-form-item>\r\n            <el-form-item>\r\n              <el-button type=\"primary\" @click=\"toggleEdit\" v-if=\"!isEditing\">编辑</el-button>\r\n              <el-button type=\"success\" @click=\"saveInfo\" v-if=\"isEditing\">保存</el-button>\r\n              <el-button @click=\"cancel\" v-if=\"isEditing\">取消</el-button>\r\n            </el-form-item>\r\n          </el-form>\r\n        </el-card>\r\n      </el-col>\r\n\r\n      <!-- 右侧：修改密码 -->\r\n      <el-col :xs=\"24\" :sm=\"24\" :md=\"12\">\r\n        <el-card class=\"password-card\">\r\n          <div slot=\"header\" class=\"clearfix\">\r\n            <span style=\"font-size: 18px; font-weight: bold;\">修改密码</span>\r\n          </div>\r\n          <el-form :model=\"passwordForm\" :rules=\"passwordRules\" ref=\"passwordForm\" label-width=\"100px\">\r\n            <el-form-item label=\"原密码\" prop=\"oldPassword\">\r\n              <el-input type=\"password\" v-model=\"passwordForm.oldPassword\" placeholder=\"请输入原密码\" autocomplete=\"off\"></el-input>\r\n            </el-form-item>\r\n            <el-form-item label=\"新密码\" prop=\"newPassword\">\r\n              <el-input type=\"password\" v-model=\"passwordForm.newPassword\" placeholder=\"请输入新密码\" autocomplete=\"off\"></el-input>\r\n            </el-form-item>\r\n            <el-form-item label=\"确认密码\" prop=\"confirmPassword\">\r\n              <el-input type=\"password\" v-model=\"passwordForm.confirmPassword\" placeholder=\"请再次输入新密码\" autocomplete=\"off\"></el-input>\r\n            </el-form-item>\r\n            <el-form-item>\r\n              <el-button type=\"primary\" @click=\"changePassword\">修改密码</el-button>\r\n              <el-button @click=\"resetPasswordForm\">重置</el-button>\r\n            </el-form-item>\r\n          </el-form>\r\n        </el-card>\r\n      </el-col>\r\n    </el-row>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport request from \"@/utils/request\";\r\n\r\nexport default {\r\n  data() {\r\n    // 自定义验证规则 - 确认密码\r\n    const validateConfirmPassword = (rule, value, callback) => {\r\n      if (value === '') {\r\n        callback(new Error('请再次输入密码'));\r\n      } else if (value !== this.passwordForm.newPassword) {\r\n        callback(new Error('两次输入密码不一致!'));\r\n      } else {\r\n        callback();\r\n      }\r\n    };\r\n\r\n    return {\r\n      ruleForm: {\r\n        id: null,\r\n        studentNumber: '',\r\n        studentName: '',\r\n        gender: 1,\r\n        majorName: '',\r\n      },\r\n      rules: {\r\n        studentNumber: [{required: true, message: '请输入学号', trigger: 'blur'}],\r\n        studentName: [{required: true, message: '请输入姓名', trigger: 'blur'}],\r\n        gender: [{required: true, message: '请选择性别', trigger: 'change'}],\r\n        majorName: [{required: true, message: '请输入专业', trigger: 'blur'}],\r\n      },\r\n      passwordForm: {\r\n        oldPassword: '',\r\n        newPassword: '',\r\n        confirmPassword: ''\r\n      },\r\n      passwordRules: {\r\n        oldPassword: [{required: true, message: '请输入原密码', trigger: 'blur'}],\r\n        newPassword: [\r\n          {required: true, message: '请输入新密码', trigger: 'blur'},\r\n          {min: 6, message: '密码长度不能少于6位', trigger: 'blur'}\r\n        ],\r\n        confirmPassword: [\r\n          {required: true, message: '请再次输入密码', trigger: 'blur'},\r\n          {validator: validateConfirmPassword, trigger: 'blur'}\r\n        ]\r\n      },\r\n      isEditing: false,\r\n      originalData: {} // 保存原始数据\r\n    };\r\n  },\r\n  created() {\r\n    this.fetchStudentInfo();\r\n  },\r\n  methods: {\r\n    fetchStudentInfo() {\r\n      const studentId = JSON.parse(localStorage.getItem(\"user\")).id;\r\n      request.get(`/student/${studentId}`).then((res) => {\r\n        if (res.code === 200) {\r\n          // 不包含密码字段\r\n          this.ruleForm = {\r\n            id: res.data.id,\r\n            studentNumber: res.data.studentNumber,\r\n            studentName: res.data.studentName,\r\n            gender: res.data.gender,\r\n            majorName: res.data.majorName\r\n          };\r\n          this.originalData = {...this.ruleForm}; // 保存原始数据\r\n        } else {\r\n          this.$message.error(res.message || '获取信息失败');\r\n        }\r\n      }).catch(err => {\r\n        console.error('获取学生信息错误:', err);\r\n        this.$message.error('获取信息失败');\r\n      });\r\n    },\r\n    toggleEdit() {\r\n      this.isEditing = true;\r\n    },\r\n    saveInfo() {\r\n      this.$refs.ruleForm.validate(valid => {\r\n        if (valid) {\r\n          // 只提交基本信息，不包含密码\r\n          request.put('/student/updateInfo', this.ruleForm).then((res) => {\r\n            if (res.code === 200) {\r\n              this.$notify.success('修改成功');\r\n              this.isEditing = false;\r\n              this.originalData = {...this.ruleForm};\r\n              // 更新 localStorage 中的用户信息\r\n              const user = JSON.parse(localStorage.getItem(\"user\"));\r\n              user.studentName = this.ruleForm.studentName;\r\n              user.majorName = this.ruleForm.majorName;\r\n              localStorage.setItem(\"user\", JSON.stringify(user));\r\n            } else {\r\n              this.$notify.error(res.message || '修改失败');\r\n            }\r\n          }).catch(err => {\r\n            console.error('修改信息错误:', err);\r\n            this.$notify.error('修改失败');\r\n          });\r\n        }\r\n      });\r\n    },\r\n    cancel() {\r\n      this.isEditing = false;\r\n      this.ruleForm = {...this.originalData}; // 恢复原始数据\r\n      this.$refs.ruleForm.clearValidate();\r\n    },\r\n    changePassword() {\r\n      this.$refs.passwordForm.validate(valid => {\r\n        if (valid) {\r\n          const studentId = JSON.parse(localStorage.getItem(\"user\")).id;\r\n          request.put('/student/changePassword', {\r\n            studentId: studentId,\r\n            oldPassword: this.passwordForm.oldPassword,\r\n            newPassword: this.passwordForm.newPassword\r\n          }).then((res) => {\r\n            if (res.code === 200) {\r\n              this.$notify.success('密码修改成功，请重新登录');\r\n              this.resetPasswordForm();\r\n              // 3秒后跳转到登录页\r\n              setTimeout(() => {\r\n                localStorage.clear();\r\n                this.$router.push('/login');\r\n              }, 3000);\r\n            } else {\r\n              this.$notify.error(res.message || '密码修改失败');\r\n            }\r\n          }).catch(err => {\r\n            console.error('修改密码错误:', err);\r\n            this.$notify.error('修改密码失败');\r\n          });\r\n        }\r\n      });\r\n    },\r\n    resetPasswordForm() {\r\n      this.passwordForm = {\r\n        oldPassword: '',\r\n        newPassword: '',\r\n        confirmPassword: ''\r\n      };\r\n      this.$refs.passwordForm.clearValidate();\r\n    }\r\n  },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.container {\r\n  padding: 20px;\r\n}\r\n\r\n.info-card, .password-card {\r\n  box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);\r\n  height: 100%;\r\n}\r\n\r\n/* 小屏幕时保持间隔 */\r\n@media (max-width: 992px) {\r\n  .el-col:first-child {\r\n    margin-bottom: 20px;\r\n  }\r\n}\r\n</style>\r\n"]},"metadata":{},"sourceType":"module"}