{"ast":null,"code":"import request from \"@/utils/request\";\nexport default {\n  data() {\n    return {\n      searchForm: {\n        date: '',\n        startTime: '',\n        endTime: '',\n        roomId: null,\n        seatType: ''\n      },\n      roomList: [],\n      availableSeats: [],\n      searched: false,\n      datePickerOptions: {\n        disabledDate(time) {\n          // 禁用今天之前的日期\n          return time.getTime() < Date.now() - 8.64e7;\n        }\n\n      }\n    };\n  },\n\n  methods: {\n    // 获取自习室列表\n    getRoomList() {\n      request.get('studyRooms/page', {\n        params: {\n          pageNum: 1,\n          pageSize: 999\n        }\n      }).then(resp => {\n        if (resp.code === 200) {\n          this.roomList = resp.data.list.filter(room => room.status === 0);\n        }\n      });\n    },\n\n    // 查询可用座位\n    searchAvailableSeats() {\n      if (!this.searchForm.date) {\n        this.$message.warning('请选择日期');\n        return;\n      }\n\n      if (!this.searchForm.startTime) {\n        this.$message.warning('请选择开始时间');\n        return;\n      }\n\n      if (!this.searchForm.endTime) {\n        this.$message.warning('请选择结束时间');\n        return;\n      }\n\n      if (!this.searchForm.roomId) {\n        this.$message.warning('请选择自习室');\n        return;\n      }\n\n      const startDateTime = `${this.searchForm.date} ${this.searchForm.startTime}:00`;\n      const endDateTime = `${this.searchForm.date} ${this.searchForm.endTime}:00`;\n      request.get('/reservation/availableSeats', {\n        params: {\n          roomId: this.searchForm.roomId,\n          startTime: startDateTime,\n          endTime: endDateTime,\n          seatType: this.searchForm.seatType\n        }\n      }).then(res => {\n        if (res.code === 200) {\n          this.availableSeats = res.data;\n          this.searched = true;\n\n          if (this.availableSeats.length === 0) {\n            this.$message.info('没有可用座位');\n          }\n        } else {\n          this.$notify.error(res.message);\n        }\n      });\n    },\n\n    // 预约座位\n    reserveSeat(seat) {\n      this.$confirm(`确认预约座位 ${seat.seatNumber}?`, '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(() => {\n        const startDateTime = `${this.searchForm.date} ${this.searchForm.startTime}:00`;\n        const endDateTime = `${this.searchForm.date} ${this.searchForm.endTime}:00`;\n        const data = {\n          startTime: startDateTime,\n          endTime: endDateTime,\n          studentId: JSON.parse(localStorage.getItem(\"user\")).id,\n          seatId: seat.id\n        };\n        request.post(\"/reservation/add\", data).then(res => {\n          if (res.code === 200) {\n            this.$notify.success('预约成功');\n            this.searchAvailableSeats(); // 重新查询可用座位\n          } else {\n            this.$notify.error(res.message);\n          }\n        });\n      }).catch(() => {});\n    },\n\n    // 重置搜索\n    resetSearch() {\n      this.searchForm = {\n        date: '',\n        startTime: '',\n        endTime: '',\n        roomId: null,\n        seatType: ''\n      };\n      this.availableSeats = [];\n      this.searched = false;\n    }\n\n  },\n\n  created() {\n    this.getRoomList();\n  }\n\n};","map":{"version":3,"mappings":"AA6GA;AAEA;EACAA;IACA;MACAC;QACAC,QADA;QAEAC,aAFA;QAGAC,WAHA;QAIAC,YAJA;QAKAC;MALA,CADA;MAQAC,YARA;MASAC,kBATA;MAUAC,eAVA;MAWAC;QACAC;UACA;UACA;QACA;;MAJA;IAXA;EAkBA,CApBA;;EAqBAC;IACA;IACAC;MACAC;QACAC;UACAC,UADA;UAEAC;QAFA;MADA,GAKAC,IALA,CAKAC;QACA;UACA;QACA;MACA,CATA;IAUA,CAbA;;IAeA;IACAC;MACA;QACA;QACA;MACA;;MACA;QACA;QACA;MACA;;MACA;QACA;QACA;MACA;;MACA;QACA;QACA;MACA;;MAEA;MACA;MAEAN;QACAC;UACAV,8BADA;UAEAF,wBAFA;UAGAC,oBAHA;UAIAE;QAJA;MADA,GAOAY,IAPA,CAOAG;QACA;UACA;UACA;;UACA;YACA;UACA;QACA,CANA,MAMA;UACA;QACA;MACA,CAjBA;IAkBA,CAvDA;;IAyDA;IACAC;MACA;QACAC,uBADA;QAEAC,sBAFA;QAGAC;MAHA,GAIAP,IAJA,CAIA;QACA;QACA;QAEA;UACAf,wBADA;UAEAC,oBAFA;UAGAsB,sDAHA;UAIAC;QAJA;QAOAb;UACA;YACA;YACA,4BAFA,CAEA;UACA,CAHA,MAGA;YACA;UACA;QACA,CAPA;MAQA,CAvBA,EAuBAc,KAvBA,CAuBA,QAvBA;IAwBA,CAnFA;;IAqFA;IACAC;MACA;QACA3B,QADA;QAEAC,aAFA;QAGAC,WAHA;QAIAC,YAJA;QAKAC;MALA;MAOA;MACA;IACA;;EAhGA,CArBA;;EAuHAwB;IACA;EACA;;AAzHA","names":["data","searchForm","date","startTime","endTime","roomId","seatType","roomList","availableSeats","searched","datePickerOptions","disabledDate","methods","getRoomList","request","params","pageNum","pageSize","then","resp","searchAvailableSeats","res","reserveSeat","confirmButtonText","cancelButtonText","type","studentId","seatId","catch","resetSearch","created"],"sourceRoot":"src/views/student","sources":["studyRoom.vue"],"sourcesContent":["<template>\r\n  <div class=\"container\">\r\n    <!-- 搜索筛选栏 -->\r\n    <div class=\"search-bar\">\r\n      <el-form :inline=\"true\">\r\n        <el-form-item label=\"选择日期\">\r\n          <el-date-picker\r\n              v-model=\"searchForm.date\"\r\n              type=\"date\"\r\n              placeholder=\"选择日期\"\r\n              value-format=\"yyyy-MM-dd\"\r\n              :picker-options=\"datePickerOptions\">\r\n          </el-date-picker>\r\n        </el-form-item>\r\n        <el-form-item label=\"开始时间\">\r\n          <el-time-select\r\n              v-model=\"searchForm.startTime\"\r\n              :picker-options=\"{\r\n              start: '06:00',\r\n              step: '00:30',\r\n              end: '23:30'\r\n            }\"\r\n              placeholder=\"选择开始时间\">\r\n          </el-time-select>\r\n        </el-form-item>\r\n        <el-form-item label=\"结束时间\">\r\n          <el-time-select\r\n              v-model=\"searchForm.endTime\"\r\n              :picker-options=\"{\r\n              start: '06:00',\r\n              step: '00:30',\r\n              end: '23:30',\r\n              minTime: searchForm.startTime\r\n            }\"\r\n              placeholder=\"选择结束时间\">\r\n          </el-time-select>\r\n        </el-form-item>\r\n        <el-form-item label=\"自习室\">\r\n          <el-select v-model=\"searchForm.roomId\" placeholder=\"请选择自习室\" clearable>\r\n            <el-option\r\n                v-for=\"room in roomList\"\r\n                :key=\"room.id\"\r\n                :label=\"room.roomNumber + ' - ' + room.location\"\r\n                :value=\"room.id\">\r\n            </el-option>\r\n          </el-select>\r\n        </el-form-item>\r\n        <el-form-item label=\"座位类型\">\r\n          <el-select v-model=\"searchForm.seatType\" placeholder=\"全部类型\" clearable>\r\n            <el-option label=\"普通座位\" value=\"普通座位\"></el-option>\r\n            <el-option label=\"插座座位\" value=\"插座座位\"></el-option>\r\n            <el-option label=\"静音区\" value=\"静音区\"></el-option>\r\n            <el-option label=\"讨论区\" value=\"讨论区\"></el-option>\r\n          </el-select>\r\n        </el-form-item>\r\n        <el-form-item>\r\n          <el-button type=\"primary\" icon=\"el-icon-search\" @click=\"searchAvailableSeats\">查询可用座位</el-button>\r\n          <el-button icon=\"el-icon-refresh\" @click=\"resetSearch\">重置</el-button>\r\n        </el-form-item>\r\n      </el-form>\r\n    </div>\r\n\r\n    <!-- 座位列表 -->\r\n    <div class=\"seat-container\" v-if=\"availableSeats.length > 0\">\r\n      <el-alert\r\n          :title=\"`找到 ${availableSeats.length} 个可用座位`\"\r\n          type=\"success\"\r\n          :closable=\"false\"\r\n          show-icon\r\n          style=\"margin-bottom: 20px;\">\r\n      </el-alert>\r\n      <el-row :gutter=\"20\">\r\n        <el-col :xs=\"24\" :sm=\"12\" :md=\"8\" :lg=\"6\" v-for=\"seat in availableSeats\" :key=\"seat.id\" style=\"margin-bottom: 20px;\">\r\n          <el-card class=\"seat-card\" shadow=\"hover\">\r\n            <div class=\"seat-info\">\r\n              <div class=\"seat-number\">\r\n                <i class=\"el-icon-s-grid\"></i>\r\n                {{ seat.seatNumber }}\r\n              </div>\r\n              <div class=\"seat-detail\">\r\n                <el-tag size=\"small\" type=\"info\">{{ seat.seatType }}</el-tag>\r\n              </div>\r\n              <div class=\"seat-location\">\r\n                <i class=\"el-icon-location-outline\"></i>\r\n                {{ seat.studyRooms ? seat.studyRooms.roomNumber : '--' }}\r\n              </div>\r\n              <div class=\"seat-location\">\r\n                {{ seat.studyRooms ? seat.studyRooms.location : '--' }}\r\n              </div>\r\n            </div>\r\n            <div class=\"seat-action\">\r\n              <el-button type=\"primary\" size=\"small\" @click=\"reserveSeat(seat)\" style=\"width: 100%;\">预约</el-button>\r\n            </div>\r\n          </el-card>\r\n        </el-col>\r\n      </el-row>\r\n    </div>\r\n\r\n    <div v-else-if=\"searched\" class=\"empty-result\">\r\n      <el-empty description=\"没有找到可用座位\"></el-empty>\r\n    </div>\r\n\r\n    <div v-else class=\"empty-result\">\r\n      <el-empty description=\"请选择日期和时间段查询可用座位\"></el-empty>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport request from \"@/utils/request\";\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      searchForm: {\r\n        date: '',\r\n        startTime: '',\r\n        endTime: '',\r\n        roomId: null,\r\n        seatType: ''\r\n      },\r\n      roomList: [],\r\n      availableSeats: [],\r\n      searched: false,\r\n      datePickerOptions: {\r\n        disabledDate(time) {\r\n          // 禁用今天之前的日期\r\n          return time.getTime() < Date.now() - 8.64e7;\r\n        }\r\n      }\r\n    };\r\n  },\r\n  methods: {\r\n    // 获取自习室列表\r\n    getRoomList() {\r\n      request.get('studyRooms/page', {\r\n        params: {\r\n          pageNum: 1,\r\n          pageSize: 999\r\n        }\r\n      }).then((resp) => {\r\n        if (resp.code === 200) {\r\n          this.roomList = resp.data.list.filter(room => room.status === 0);\r\n        }\r\n      });\r\n    },\r\n\r\n    // 查询可用座位\r\n    searchAvailableSeats() {\r\n      if (!this.searchForm.date) {\r\n        this.$message.warning('请选择日期');\r\n        return;\r\n      }\r\n      if (!this.searchForm.startTime) {\r\n        this.$message.warning('请选择开始时间');\r\n        return;\r\n      }\r\n      if (!this.searchForm.endTime) {\r\n        this.$message.warning('请选择结束时间');\r\n        return;\r\n      }\r\n      if (!this.searchForm.roomId) {\r\n        this.$message.warning('请选择自习室');\r\n        return;\r\n      }\r\n\r\n      const startDateTime = `${this.searchForm.date} ${this.searchForm.startTime}:00`;\r\n      const endDateTime = `${this.searchForm.date} ${this.searchForm.endTime}:00`;\r\n\r\n      request.get('/reservation/availableSeats', {\r\n        params: {\r\n          roomId: this.searchForm.roomId,\r\n          startTime: startDateTime,\r\n          endTime: endDateTime,\r\n          seatType: this.searchForm.seatType\r\n        }\r\n      }).then((res) => {\r\n        if (res.code === 200) {\r\n          this.availableSeats = res.data;\r\n          this.searched = true;\r\n          if (this.availableSeats.length === 0) {\r\n            this.$message.info('没有可用座位');\r\n          }\r\n        } else {\r\n          this.$notify.error(res.message);\r\n        }\r\n      });\r\n    },\r\n\r\n    // 预约座位\r\n    reserveSeat(seat) {\r\n      this.$confirm(`确认预约座位 ${seat.seatNumber}?`, '提示', {\r\n        confirmButtonText: '确定',\r\n        cancelButtonText: '取消',\r\n        type: 'warning'\r\n      }).then(() => {\r\n        const startDateTime = `${this.searchForm.date} ${this.searchForm.startTime}:00`;\r\n        const endDateTime = `${this.searchForm.date} ${this.searchForm.endTime}:00`;\r\n        \r\n        const data = {\r\n          startTime: startDateTime,\r\n          endTime: endDateTime,\r\n          studentId: JSON.parse(localStorage.getItem(\"user\")).id,\r\n          seatId: seat.id\r\n        };\r\n        \r\n        request.post(\"/reservation/add\", data).then((res) => {\r\n          if (res.code === 200) {\r\n            this.$notify.success('预约成功');\r\n            this.searchAvailableSeats(); // 重新查询可用座位\r\n          } else {\r\n            this.$notify.error(res.message);\r\n          }\r\n        });\r\n      }).catch(() => {});\r\n    },\r\n\r\n    // 重置搜索\r\n    resetSearch() {\r\n      this.searchForm = {\r\n        date: '',\r\n        startTime: '',\r\n        endTime: '',\r\n        roomId: null,\r\n        seatType: ''\r\n      };\r\n      this.availableSeats = [];\r\n      this.searched = false;\r\n    }\r\n  },\r\n  created() {\r\n    this.getRoomList();\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.container {\r\n  padding: 20px;\r\n}\r\n\r\n.search-bar {\r\n  background: #f5f7fa;\r\n  padding: 20px;\r\n  border-radius: 4px;\r\n  margin-bottom: 20px;\r\n}\r\n\r\n.seat-container {\r\n  margin-top: 20px;\r\n}\r\n\r\n.seat-card {\r\n  border-radius: 8px;\r\n  transition: all 0.3s;\r\n}\r\n\r\n.seat-card:hover {\r\n  transform: translateY(-5px);\r\n}\r\n\r\n.seat-info {\r\n  padding: 10px 0;\r\n}\r\n\r\n.seat-number {\r\n  font-size: 24px;\r\n  font-weight: bold;\r\n  color: #409EFF;\r\n  margin-bottom: 10px;\r\n}\r\n\r\n.seat-detail {\r\n  margin: 8px 0;\r\n}\r\n\r\n.seat-location {\r\n  color: #666;\r\n  font-size: 14px;\r\n  margin: 5px 0;\r\n}\r\n\r\n.seat-action {\r\n  margin-top: 15px;\r\n  padding-top: 15px;\r\n  border-top: 1px solid #eee;\r\n}\r\n\r\n.empty-result {\r\n  padding: 50px 0;\r\n  text-align: center;\r\n}\r\n</style>"]},"metadata":{},"sourceType":"module"}