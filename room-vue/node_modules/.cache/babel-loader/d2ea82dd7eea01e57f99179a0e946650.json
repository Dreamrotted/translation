{"ast":null,"code":"import request from \"@/utils/request\";\nexport default {\n  data() {\n    return {\n      dataList: [],\n      current: 1,\n      pageSize: 10,\n      totalPage: 0,\n      dataListLoading: false,\n      query: {\n        studentNumber: '',\n        violationType: '',\n        recordType: null,\n        status: null,\n        dateRange: null\n      },\n      addDialogVisible: false,\n      addForm: {\n        studentNumber: null,\n        violationType: '',\n        violationDesc: ''\n      },\n      addFormRules: {\n        studentNumber: [{\n          required: true,\n          message: '请输入学号',\n          trigger: 'blur'\n        }],\n        violationType: [{\n          required: true,\n          message: '请选择违规类型',\n          trigger: 'change'\n        }],\n        violationDesc: [{\n          required: true,\n          message: '请输入违规描述',\n          trigger: 'blur'\n        }]\n      },\n      studentInfo: {}\n    };\n  },\n\n  methods: {\n    getDataList() {\n      this.dataListLoading = true;\n      const params = {\n        pageNum: this.current,\n        pageSize: this.pageSize\n      };\n\n      if (this.query.studentNumber) {\n        params.studentNumber = this.query.studentNumber;\n      }\n\n      if (this.query.violationType) {\n        params.violationType = this.query.violationType;\n      }\n\n      if (this.query.recordType !== null && this.query.recordType !== '') {\n        params.recordType = this.query.recordType;\n      }\n\n      if (this.query.status !== null && this.query.status !== '') {\n        params.status = this.query.status;\n      }\n\n      if (this.query.dateRange && this.query.dateRange.length === 2) {\n        params.startDate = this.query.dateRange[0];\n        params.endDate = this.query.dateRange[1];\n      }\n\n      request.get('/violation/page', {\n        params\n      }).then(resp => {\n        if (resp.code === 200) {\n          this.dataList = resp.data.list;\n          this.totalPage = resp.data.total;\n        } else {\n          this.dataList = [];\n          this.$message.error(resp.message || '获取数据失败');\n        }\n\n        this.dataListLoading = false;\n      }).catch(err => {\n        console.error('获取违规记录错误:', err);\n        this.dataList = [];\n        this.dataListLoading = false;\n        this.$message.error('获取数据失败，请稍后重试');\n      });\n    },\n\n    resetSearch() {\n      this.query = {\n        studentNumber: '',\n        violationType: '',\n        recordType: null,\n        status: null,\n        dateRange: null\n      };\n      this.current = 1;\n      this.getDataList();\n    },\n\n    sizeChangeHandle(val) {\n      this.pageSize = val;\n      this.current = 1;\n      this.getDataList();\n    },\n\n    currentChangeHandle(val) {\n      this.current = val;\n      this.getDataList();\n    },\n\n    handleAdd() {\n      this.addDialogVisible = true;\n    },\n\n    getStudentInfo() {\n      if (this.addForm.studentNumber) {\n        request.get('/student/getByNumber', {\n          params: {\n            studentNumber: this.addForm.studentNumber\n          }\n        }).then(resp => {\n          if (resp.code === 200 && resp.data) {\n            this.studentInfo = resp.data;\n          } else {\n            this.studentInfo = {};\n            this.$message.warning('未找到该学生');\n          }\n        });\n      }\n    },\n\n    submitAdd() {\n      this.$refs.addForm.validate(valid => {\n        if (valid) {\n          request.post('/violation/add', {\n            studentId: this.studentInfo.id,\n            violationType: this.addForm.violationType,\n            violationDesc: this.addForm.violationDesc,\n            adminId: JSON.parse(localStorage.getItem(\"user\")).id\n          }).then(resp => {\n            if (resp.code === 200) {\n              this.$message.success('登记成功');\n              this.addDialogVisible = false;\n              this.getDataList();\n            } else {\n              this.$message.error(resp.message || '登记失败');\n            }\n          });\n        }\n      });\n    },\n\n    resetAddForm() {\n      this.$refs.addForm.resetFields();\n      this.studentInfo = {};\n    },\n\n    handleProcess(row) {\n      this.$confirm('确认标记为已处理?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(() => {\n        request.put('/violation/update', {\n          id: row.id,\n          status: 1\n        }).then(resp => {\n          if (resp.code === 200) {\n            this.$message.success('操作成功');\n            this.getDataList();\n          } else {\n            this.$message.error(resp.message || '操作失败');\n          }\n        });\n      }).catch(() => {});\n    },\n\n    handleDelete(id) {\n      this.$confirm('确认删除该记录?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(() => {\n        request.delete(`/violation/delete/${id}`).then(resp => {\n          if (resp.code === 200) {\n            this.$message.success('删除成功');\n            this.getDataList();\n          } else {\n            this.$message.error(resp.message || '删除失败');\n          }\n        });\n      }).catch(() => {});\n    }\n\n  },\n\n  created() {\n    this.getDataList();\n  }\n\n};","map":{"version":3,"mappings":"AAgHA;AAEA;EACAA;IACA;MACAC,YADA;MAEAC,UAFA;MAGAC,YAHA;MAIAC,YAJA;MAKAC,sBALA;MAMAC;QACAC,iBADA;QAEAC,iBAFA;QAGAC,gBAHA;QAIAC,YAJA;QAKAC;MALA,CANA;MAaAC,uBAbA;MAcAC;QACAN,mBADA;QAEAC,iBAFA;QAGAM;MAHA,CAdA;MAmBAC;QACAR;UAAAS;UAAAC;UAAAC;QAAA,EADA;QAEAV;UAAAQ;UAAAC;UAAAC;QAAA,EAFA;QAGAJ;UAAAE;UAAAC;UAAAC;QAAA;MAHA,CAnBA;MAwBAC;IAxBA;EA0BA,CA5BA;;EA6BAC;IACAC;MACA;MACA;QACAC,qBADA;QAEAnB;MAFA;;MAKA;QACAoB;MACA;;MACA;QACAA;MACA;;MACA;QACAA;MACA;;MACA;QACAA;MACA;;MACA;QACAA;QACAA;MACA;;MAEAC;QAAAD;MAAA;QACA;UACA;UACA;QACA,CAHA,MAGA;UACA;UACA;QACA;;QACA;MACA,CATA,EASAE,KATA,CASAC;QACAC;QACA;QACA;QACA;MACA,CAdA;IAeA,CAxCA;;IAyCAC;MACA;QACArB,iBADA;QAEAC,iBAFA;QAGAC,gBAHA;QAIAC,YAJA;QAKAC;MALA;MAOA;MACA;IACA,CAnDA;;IAoDAkB;MACA;MACA;MACA;IACA,CAxDA;;IAyDAC;MACA;MACA;IACA,CA5DA;;IA6DAC;MACA;IACA,CA/DA;;IAgEAC;MACA;QACAR;UACAD;YAAAhB;UAAA;QADA,GAEA0B,IAFA,CAEAC;UACA;YACA;UACA,CAFA,MAEA;YACA;YACA;UACA;QACA,CATA;MAUA;IACA,CA7EA;;IA8EAC;MACA;QACA;UACAX;YACAY,8BADA;YAEA5B,yCAFA;YAGAM,yCAHA;YAIAuB;UAJA,GAKAJ,IALA,CAKAC;YACA;cACA;cACA;cACA;YACA,CAJA,MAIA;cACA;YACA;UACA,CAbA;QAcA;MACA,CAjBA;IAkBA,CAjGA;;IAkGAI;MACA;MACA;IACA,CArGA;;IAsGAC;MACA;QACAC,uBADA;QAEAC,sBAFA;QAGAC;MAHA,GAIAT,IAJA,CAIA;QACAT;UACAmB,UADA;UAEAjC;QAFA,GAGAuB,IAHA,CAGAC;UACA;YACA;YACA;UACA,CAHA,MAGA;YACA;UACA;QACA,CAVA;MAWA,CAhBA,EAgBAT,KAhBA,CAgBA,QAhBA;IAiBA,CAxHA;;IAyHAmB;MACA;QACAJ,uBADA;QAEAC,sBAFA;QAGAC;MAHA,GAIAT,IAJA,CAIA;QACAT;UACA;YACA;YACA;UACA,CAHA,MAGA;YACA;UACA;QACA,CAPA;MAQA,CAbA,EAaAC,KAbA,CAaA,QAbA;IAcA;;EAxIA,CA7BA;;EAuKAoB;IACA;EACA;;AAzKA","names":["data","dataList","current","pageSize","totalPage","dataListLoading","query","studentNumber","violationType","recordType","status","dateRange","addDialogVisible","addForm","violationDesc","addFormRules","required","message","trigger","studentInfo","methods","getDataList","pageNum","params","request","catch","err","console","resetSearch","sizeChangeHandle","currentChangeHandle","handleAdd","getStudentInfo","then","resp","submitAdd","studentId","adminId","resetAddForm","handleProcess","confirmButtonText","cancelButtonText","type","id","handleDelete","created"],"sourceRoot":"src/views/admin","sources":["violation.vue"],"sourcesContent":["<!--管理员违规记录管理-->\r\n<template>\r\n  <div class=\"container\">\r\n    <!--条件查询-->\r\n    <div class=\"search-bar\">\r\n      <el-input v-model=\"query.studentNumber\" placeholder=\"学号\" style=\"width: 150px;\"\r\n                @keyup.enter.native=\"getDataList\"></el-input>\r\n      <el-select v-model=\"query.violationType\" placeholder=\"违规类型\" style=\"width: 150px; margin-left: 10px;\" clearable>\r\n        <el-option label=\"未按时签到\" value=\"未按时签到\"></el-option>\r\n        <el-option label=\"未主动签退\" value=\"未主动签退\"></el-option>\r\n        <el-option label=\"其他\" value=\"其他\"></el-option>\r\n      </el-select>\r\n      <el-select v-model=\"query.recordType\" placeholder=\"记录类型\" style=\"width: 150px; margin-left: 10px;\" clearable>\r\n        <el-option label=\"系统自动\" :value=\"0\"></el-option>\r\n        <el-option label=\"管理员手动\" :value=\"1\"></el-option>\r\n      </el-select>\r\n      <el-select v-model=\"query.status\" placeholder=\"处理状态\" style=\"width: 150px; margin-left: 10px;\" clearable>\r\n        <el-option label=\"未处理\" :value=\"0\"></el-option>\r\n        <el-option label=\"已处理\" :value=\"1\"></el-option>\r\n      </el-select>\r\n      <el-date-picker\r\n          v-model=\"query.dateRange\"\r\n          type=\"daterange\"\r\n          range-separator=\"至\"\r\n          start-placeholder=\"开始日期\"\r\n          end-placeholder=\"结束日期\"\r\n          value-format=\"yyyy-MM-dd\"\r\n          style=\"width: 240px; margin-left: 10px;\">\r\n      </el-date-picker>\r\n      <el-button type=\"primary\" icon=\"el-icon-search\" @click=\"getDataList\" style=\"margin-left: 10px\">搜索</el-button>\r\n      <el-button icon=\"el-icon-refresh\" @click=\"resetSearch\" style=\"margin-left: 10px\">重置</el-button>\r\n      <el-button type=\"success\" icon=\"el-icon-plus\" @click=\"handleAdd\" style=\"margin-left: 10px\">手动登记</el-button>\r\n    </div>\r\n\r\n    <el-table :data=\"dataList\"\r\n              border\r\n              stripe\r\n              v-loading=\"dataListLoading\"\r\n              highlight-current-row>\r\n      <el-table-column type=\"index\" min-width=\"60\" header-align=\"center\" align=\"center\" label=\"序号\"></el-table-column>\r\n      <el-table-column prop=\"student.studentName\" header-align=\"center\" align=\"center\" min-width=\"100\" label=\"姓名\"></el-table-column>\r\n      <el-table-column prop=\"student.studentNumber\" header-align=\"center\" align=\"center\" min-width=\"100\" label=\"学号\"></el-table-column>\r\n      <el-table-column prop=\"violationType\" header-align=\"center\" align=\"center\" min-width=\"120\" label=\"违规类型\">\r\n        <template v-slot=\"scope\">\r\n          <el-tag v-if=\"scope.row.violationType === '未按时签到'\" type=\"warning\">{{ scope.row.violationType }}</el-tag>\r\n          <el-tag v-else-if=\"scope.row.violationType === '未主动签退'\" type=\"info\">{{ scope.row.violationType }}</el-tag>\r\n          <el-tag v-else>{{ scope.row.violationType }}</el-tag>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column prop=\"violationDesc\" header-align=\"center\" align=\"center\" min-width=\"200\" label=\"违规描述\"></el-table-column>\r\n      <el-table-column prop=\"violationTime\" header-align=\"center\" align=\"center\" min-width=\"160\" label=\"违规时间\"></el-table-column>\r\n      <el-table-column prop=\"recordType\" header-align=\"center\" align=\"center\" min-width=\"100\" label=\"记录类型\">\r\n        <template v-slot=\"scope\">\r\n          <el-tag v-if=\"scope.row.recordType === 0\" type=\"success\">系统自动</el-tag>\r\n          <el-tag v-else type=\"primary\">管理员手动</el-tag>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column prop=\"status\" header-align=\"center\" align=\"center\" min-width=\"100\" label=\"处理状态\">\r\n        <template v-slot=\"scope\">\r\n          <el-tag v-if=\"scope.row.status === 0\" type=\"danger\">未处理</el-tag>\r\n          <el-tag v-else type=\"success\">已处理</el-tag>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column fixed=\"right\" header-align=\"center\" align=\"center\" width=\"180\" label=\"操作\">\r\n        <template v-slot=\"scope\">\r\n          <el-button type=\"primary\" size=\"small\" @click=\"handleProcess(scope.row)\" v-if=\"scope.row.status === 0\">\r\n            标记已处理\r\n          </el-button>\r\n          <el-button type=\"danger\" size=\"small\" @click=\"handleDelete(scope.row.id)\">删除</el-button>\r\n        </template>\r\n      </el-table-column>\r\n    </el-table>\r\n\r\n    <el-pagination\r\n        @size-change=\"sizeChangeHandle\"\r\n        @current-change=\"currentChangeHandle\"\r\n        :current-page=\"current\"\r\n        :page-sizes=\"[10, 20, 50, 100]\"\r\n        :page-size=\"pageSize\"\r\n        :total=\"totalPage\"\r\n        layout=\"total, sizes, prev, pager, next, jumper\">\r\n    </el-pagination>\r\n\r\n    <!-- 添加违规记录对话框 -->\r\n    <el-dialog title=\"手动登记违规\" :visible.sync=\"addDialogVisible\" width=\"500px\" @close=\"resetAddForm\">\r\n      <el-form :model=\"addForm\" :rules=\"addFormRules\" ref=\"addForm\" label-width=\"100px\">\r\n        <el-form-item label=\"学号\" prop=\"studentNumber\">\r\n          <el-input v-model.number=\"addForm.studentNumber\" placeholder=\"请输入学号\" @blur=\"getStudentInfo\"></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"学生姓名\" v-if=\"studentInfo.studentName\">\r\n          <el-input v-model=\"studentInfo.studentName\" disabled></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"违规类型\" prop=\"violationType\">\r\n          <el-select v-model=\"addForm.violationType\" placeholder=\"请选择违规类型\" style=\"width: 100%;\">\r\n            <el-option label=\"未按时签到\" value=\"未按时签到\"></el-option>\r\n            <el-option label=\"未主动签退\" value=\"未主动签退\"></el-option>\r\n            <el-option label=\"其他\" value=\"其他\"></el-option>\r\n          </el-select>\r\n        </el-form-item>\r\n        <el-form-item label=\"违规描述\" prop=\"violationDesc\">\r\n          <el-input type=\"textarea\" v-model=\"addForm.violationDesc\" placeholder=\"请输入违规描述\" :rows=\"3\"></el-input>\r\n        </el-form-item>\r\n      </el-form>\r\n      <div slot=\"footer\">\r\n        <el-button @click=\"addDialogVisible = false\">取消</el-button>\r\n        <el-button type=\"primary\" @click=\"submitAdd\">确定</el-button>\r\n      </div>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport request from \"@/utils/request\";\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      dataList: [],\r\n      current: 1,\r\n      pageSize: 10,\r\n      totalPage: 0,\r\n      dataListLoading: false,\r\n      query: {\r\n        studentNumber: '',\r\n        violationType: '',\r\n        recordType: null,\r\n        status: null,\r\n        dateRange: null\r\n      },\r\n      addDialogVisible: false,\r\n      addForm: {\r\n        studentNumber: null,\r\n        violationType: '',\r\n        violationDesc: ''\r\n      },\r\n      addFormRules: {\r\n        studentNumber: [{required: true, message: '请输入学号', trigger: 'blur'}],\r\n        violationType: [{required: true, message: '请选择违规类型', trigger: 'change'}],\r\n        violationDesc: [{required: true, message: '请输入违规描述', trigger: 'blur'}]\r\n      },\r\n      studentInfo: {}\r\n    };\r\n  },\r\n  methods: {\r\n    getDataList() {\r\n      this.dataListLoading = true;\r\n      const params = {\r\n        pageNum: this.current,\r\n        pageSize: this.pageSize,\r\n      };\r\n\r\n      if (this.query.studentNumber) {\r\n        params.studentNumber = this.query.studentNumber;\r\n      }\r\n      if (this.query.violationType) {\r\n        params.violationType = this.query.violationType;\r\n      }\r\n      if (this.query.recordType !== null && this.query.recordType !== '') {\r\n        params.recordType = this.query.recordType;\r\n      }\r\n      if (this.query.status !== null && this.query.status !== '') {\r\n        params.status = this.query.status;\r\n      }\r\n      if (this.query.dateRange && this.query.dateRange.length === 2) {\r\n        params.startDate = this.query.dateRange[0];\r\n        params.endDate = this.query.dateRange[1];\r\n      }\r\n\r\n      request.get('/violation/page', {params}).then((resp) => {\r\n        if (resp.code === 200) {\r\n          this.dataList = resp.data.list;\r\n          this.totalPage = resp.data.total;\r\n        } else {\r\n          this.dataList = [];\r\n          this.$message.error(resp.message || '获取数据失败');\r\n        }\r\n        this.dataListLoading = false;\r\n      }).catch(err => {\r\n        console.error('获取违规记录错误:', err);\r\n        this.dataList = [];\r\n        this.dataListLoading = false;\r\n        this.$message.error('获取数据失败，请稍后重试');\r\n      });\r\n    },\r\n    resetSearch() {\r\n      this.query = {\r\n        studentNumber: '',\r\n        violationType: '',\r\n        recordType: null,\r\n        status: null,\r\n        dateRange: null\r\n      };\r\n      this.current = 1;\r\n      this.getDataList();\r\n    },\r\n    sizeChangeHandle(val) {\r\n      this.pageSize = val;\r\n      this.current = 1;\r\n      this.getDataList();\r\n    },\r\n    currentChangeHandle(val) {\r\n      this.current = val;\r\n      this.getDataList();\r\n    },\r\n    handleAdd() {\r\n      this.addDialogVisible = true;\r\n    },\r\n    getStudentInfo() {\r\n      if (this.addForm.studentNumber) {\r\n        request.get('/student/getByNumber', {\r\n          params: {studentNumber: this.addForm.studentNumber}\r\n        }).then(resp => {\r\n          if (resp.code === 200 && resp.data) {\r\n            this.studentInfo = resp.data;\r\n          } else {\r\n            this.studentInfo = {};\r\n            this.$message.warning('未找到该学生');\r\n          }\r\n        });\r\n      }\r\n    },\r\n    submitAdd() {\r\n      this.$refs.addForm.validate(valid => {\r\n        if (valid) {\r\n          request.post('/violation/add', {\r\n            studentId: this.studentInfo.id,\r\n            violationType: this.addForm.violationType,\r\n            violationDesc: this.addForm.violationDesc,\r\n            adminId: JSON.parse(localStorage.getItem(\"user\")).id\r\n          }).then(resp => {\r\n            if (resp.code === 200) {\r\n              this.$message.success('登记成功');\r\n              this.addDialogVisible = false;\r\n              this.getDataList();\r\n            } else {\r\n              this.$message.error(resp.message || '登记失败');\r\n            }\r\n          });\r\n        }\r\n      });\r\n    },\r\n    resetAddForm() {\r\n      this.$refs.addForm.resetFields();\r\n      this.studentInfo = {};\r\n    },\r\n    handleProcess(row) {\r\n      this.$confirm('确认标记为已处理?', '提示', {\r\n        confirmButtonText: '确定',\r\n        cancelButtonText: '取消',\r\n        type: 'warning'\r\n      }).then(() => {\r\n        request.put('/violation/update', {\r\n          id: row.id,\r\n          status: 1\r\n        }).then(resp => {\r\n          if (resp.code === 200) {\r\n            this.$message.success('操作成功');\r\n            this.getDataList();\r\n          } else {\r\n            this.$message.error(resp.message || '操作失败');\r\n          }\r\n        });\r\n      }).catch(() => {});\r\n    },\r\n    handleDelete(id) {\r\n      this.$confirm('确认删除该记录?', '提示', {\r\n        confirmButtonText: '确定',\r\n        cancelButtonText: '取消',\r\n        type: 'warning'\r\n      }).then(() => {\r\n        request.delete(`/violation/delete/${id}`).then(resp => {\r\n          if (resp.code === 200) {\r\n            this.$message.success('删除成功');\r\n            this.getDataList();\r\n          } else {\r\n            this.$message.error(resp.message || '删除失败');\r\n          }\r\n        });\r\n      }).catch(() => {});\r\n    }\r\n  },\r\n  created() {\r\n    this.getDataList();\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.container {\r\n  padding: 20px;\r\n}\r\n\r\n.search-bar {\r\n  margin-bottom: 20px;\r\n}\r\n</style>\r\n"]},"metadata":{},"sourceType":"module"}