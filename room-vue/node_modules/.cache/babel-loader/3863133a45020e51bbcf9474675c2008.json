{"ast":null,"code":"import request from \"@/utils/request\";\nexport default {\n  data() {\n    return {\n      dataList: [],\n      current: 1,\n      pageSize: 10,\n      totalPage: 0,\n      dataListLoading: false,\n      query: {\n        studentNumber: '',\n        type: null,\n        status: null,\n        dateRange: null\n      },\n      replyDialogVisible: false,\n      currentFeedback: {},\n      replyForm: {\n        reply: ''\n      },\n      replyFormRules: {\n        reply: [{\n          required: true,\n          message: '请输入回复内容',\n          trigger: 'blur'\n        }]\n      }\n    };\n  },\n\n  methods: {\n    getDataList() {\n      this.dataListLoading = true;\n      const params = {\n        pageNum: this.current,\n        pageSize: this.pageSize\n      };\n\n      if (this.query.studentNumber) {\n        params.studentNumber = this.query.studentNumber;\n      }\n\n      if (this.query.type !== null && this.query.type !== '') {\n        params.type = this.query.type;\n      }\n\n      if (this.query.status !== null && this.query.status !== '') {\n        params.status = this.query.status;\n      }\n\n      if (this.query.dateRange && this.query.dateRange.length === 2) {\n        params.startDate = this.query.dateRange[0];\n        params.endDate = this.query.dateRange[1];\n      }\n\n      request.get('/feedback/page', {\n        params\n      }).then(resp => {\n        if (resp.code === 200) {\n          this.dataList = resp.data.list;\n          this.totalPage = resp.data.total;\n        } else {\n          this.dataList = [];\n          this.$message.error(resp.message || '获取数据失败');\n        }\n\n        this.dataListLoading = false;\n      }).catch(err => {\n        console.error('获取反馈错误:', err);\n        this.dataList = [];\n        this.dataListLoading = false;\n        this.$message.error('获取数据失败，请稍后重试');\n      });\n    },\n\n    resetSearch() {\n      this.query = {\n        studentNumber: '',\n        type: null,\n        status: null,\n        dateRange: null\n      };\n      this.current = 1;\n      this.getDataList();\n    },\n\n    sizeChangeHandle(val) {\n      this.pageSize = val;\n      this.current = 1;\n      this.getDataList();\n    },\n\n    currentChangeHandle(val) {\n      this.current = val;\n      this.getDataList();\n    },\n\n    handleReply(row) {\n      this.currentFeedback = row;\n      this.replyDialogVisible = true;\n    },\n\n    resetReplyForm() {\n      this.$refs.replyForm.resetFields();\n      this.currentFeedback = {};\n    },\n\n    submitReply() {\n      this.$refs.replyForm.validate(valid => {\n        if (valid) {\n          request.post('/feedback/reply', {\n            id: this.currentFeedback.id,\n            reply: this.replyForm.reply,\n            adminId: JSON.parse(localStorage.getItem(\"user\")).id\n          }).then(resp => {\n            if (resp.code === 200) {\n              this.$message.success('回复成功');\n              this.replyDialogVisible = false;\n              this.getDataList();\n            } else {\n              this.$message.error(resp.message || '回复失败');\n            }\n          });\n        }\n      });\n    },\n\n    handleClose(id) {\n      this.$confirm('确认关闭该反馈?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(() => {\n        request.put(`/feedback/close/${id}`).then(resp => {\n          if (resp.code === 200) {\n            this.$message.success('关闭成功');\n            this.getDataList();\n          } else {\n            this.$message.error(resp.message || '关闭失败');\n          }\n        });\n      }).catch(() => {});\n    },\n\n    handleDelete(id) {\n      this.$confirm('确认删除该记录?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(() => {\n        request.delete(`/feedback/delete/${id}`).then(resp => {\n          if (resp.code === 200) {\n            this.$message.success('删除成功');\n            this.getDataList();\n          } else {\n            this.$message.error(resp.message || '删除失败');\n          }\n        });\n      }).catch(() => {});\n    }\n\n  },\n\n  created() {\n    this.getDataList();\n  }\n\n};","map":{"version":3,"mappings":"AAiHA;AAEA;EACAA;IACA;MACAC,YADA;MAEAC,UAFA;MAGAC,YAHA;MAIAC,YAJA;MAKAC,sBALA;MAMAC;QACAC,iBADA;QAEAC,UAFA;QAGAC,YAHA;QAIAC;MAJA,CANA;MAYAC,yBAZA;MAaAC,mBAbA;MAcAC;QACAC;MADA,CAdA;MAiBAC;QACAD;UAAAE;UAAAC;UAAAC;QAAA;MADA;IAjBA;EAqBA,CAvBA;;EAwBAC;IACAC;MACA;MACA;QACAC,qBADA;QAEAlB;MAFA;;MAKA;QACAmB;MACA;;MACA;QACAA;MACA;;MACA;QACAA;MACA;;MACA;QACAA;QACAA;MACA;;MAEAC;QAAAD;MAAA;QACA;UACA;UACA;QACA,CAHA,MAGA;UACA;UACA;QACA;;QACA;MACA,CATA,EASAE,KATA,CASAC;QACAC;QACA;QACA;QACA;MACA,CAdA;IAeA,CArCA;;IAsCAC;MACA;QACApB,iBADA;QAEAC,UAFA;QAGAC,YAHA;QAIAC;MAJA;MAMA;MACA;IACA,CA/CA;;IAgDAkB;MACA;MACA;MACA;IACA,CApDA;;IAqDAC;MACA;MACA;IACA,CAxDA;;IAyDAC;MACA;MACA;IACA,CA5DA;;IA6DAC;MACA;MACA;IACA,CAhEA;;IAiEAC;MACA;QACA;UACAT;YACAU,2BADA;YAEAnB,2BAFA;YAGAoB;UAHA,GAIAC,IAJA,CAIAC;YACA;cACA;cACA;cACA;YACA,CAJA,MAIA;cACA;YACA;UACA,CAZA;QAaA;MACA,CAhBA;IAiBA,CAnFA;;IAoFAC;MACA;QACAC,uBADA;QAEAC,sBAFA;QAGA/B;MAHA,GAIA2B,IAJA,CAIA;QACAZ;UACA;YACA;YACA;UACA,CAHA,MAGA;YACA;UACA;QACA,CAPA;MAQA,CAbA,EAaAC,KAbA,CAaA,QAbA;IAcA,CAnGA;;IAoGAgB;MACA;QACAF,uBADA;QAEAC,sBAFA;QAGA/B;MAHA,GAIA2B,IAJA,CAIA;QACAZ;UACA;YACA;YACA;UACA,CAHA,MAGA;YACA;UACA;QACA,CAPA;MAQA,CAbA,EAaAC,KAbA,CAaA,QAbA;IAcA;;EAnHA,CAxBA;;EA6IAiB;IACA;EACA;;AA/IA","names":["data","dataList","current","pageSize","totalPage","dataListLoading","query","studentNumber","type","status","dateRange","replyDialogVisible","currentFeedback","replyForm","reply","replyFormRules","required","message","trigger","methods","getDataList","pageNum","params","request","catch","err","console","resetSearch","sizeChangeHandle","currentChangeHandle","handleReply","resetReplyForm","submitReply","id","adminId","then","resp","handleClose","confirmButtonText","cancelButtonText","handleDelete","created"],"sourceRoot":"src/views/admin","sources":["feedback.vue"],"sourcesContent":["<!--管理员投诉与评价管理-->\r\n<template>\r\n  <div class=\"container\">\r\n    <!--条件查询-->\r\n    <div class=\"search-bar\">\r\n      <el-input v-model=\"query.studentNumber\" placeholder=\"学号\" style=\"width: 150px;\"\r\n                @keyup.enter.native=\"getDataList\"></el-input>\r\n      <el-select v-model=\"query.type\" placeholder=\"类型\" style=\"width: 120px; margin-left: 10px;\" clearable>\r\n        <el-option label=\"投诉\" :value=\"0\"></el-option>\r\n        <el-option label=\"评价\" :value=\"1\"></el-option>\r\n      </el-select>\r\n      <el-select v-model=\"query.status\" placeholder=\"状态\" style=\"width: 120px; margin-left: 10px;\" clearable>\r\n        <el-option label=\"待处理\" :value=\"0\"></el-option>\r\n        <el-option label=\"已回复\" :value=\"1\"></el-option>\r\n        <el-option label=\"已关闭\" :value=\"2\"></el-option>\r\n      </el-select>\r\n      <el-date-picker\r\n          v-model=\"query.dateRange\"\r\n          type=\"daterange\"\r\n          range-separator=\"至\"\r\n          start-placeholder=\"开始日期\"\r\n          end-placeholder=\"结束日期\"\r\n          value-format=\"yyyy-MM-dd\"\r\n          style=\"width: 240px; margin-left: 10px;\">\r\n      </el-date-picker>\r\n      <el-button type=\"primary\" icon=\"el-icon-search\" @click=\"getDataList\" style=\"margin-left: 10px\">搜索</el-button>\r\n      <el-button icon=\"el-icon-refresh\" @click=\"resetSearch\" style=\"margin-left: 10px\">重置</el-button>\r\n    </div>\r\n\r\n    <el-table :data=\"dataList\"\r\n              border\r\n              stripe\r\n              v-loading=\"dataListLoading\"\r\n              highlight-current-row>\r\n      <el-table-column type=\"expand\">\r\n        <template v-slot=\"scope\">\r\n          <div style=\"padding: 10px 20px;\">\r\n            <p><strong>详细内容：</strong>{{ scope.row.content }}</p>\r\n            <p v-if=\"scope.row.studyRooms\">\r\n              <strong>关联自习室：</strong>{{ scope.row.studyRooms.roomNumber }} - {{ scope.row.studyRooms.location }}\r\n            </p>\r\n            <p v-if=\"scope.row.reply\">\r\n              <strong style=\"color: #409EFF;\">管理员回复：</strong>\r\n              <span style=\"color: #606266;\">{{ scope.row.reply }}</span>\r\n            </p>\r\n            <p v-if=\"scope.row.replyTime\">\r\n              <strong>回复时间：</strong>{{ scope.row.replyTime }}\r\n            </p>\r\n          </div>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column type=\"index\" min-width=\"60\" header-align=\"center\" align=\"center\" label=\"序号\"></el-table-column>\r\n      <el-table-column prop=\"student.studentName\" header-align=\"center\" align=\"center\" min-width=\"100\" label=\"姓名\"></el-table-column>\r\n      <el-table-column prop=\"student.studentNumber\" header-align=\"center\" align=\"center\" min-width=\"100\" label=\"学号\"></el-table-column>\r\n      <el-table-column prop=\"type\" header-align=\"center\" align=\"center\" min-width=\"80\" label=\"类型\">\r\n        <template v-slot=\"scope\">\r\n          <el-tag v-if=\"scope.row.type === 0\" type=\"warning\">投诉</el-tag>\r\n          <el-tag v-else type=\"success\">评价</el-tag>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column prop=\"title\" header-align=\"center\" align=\"center\" min-width=\"150\" label=\"标题\" show-overflow-tooltip></el-table-column>\r\n      <el-table-column prop=\"status\" header-align=\"center\" align=\"center\" min-width=\"90\" label=\"状态\">\r\n        <template v-slot=\"scope\">\r\n          <el-tag v-if=\"scope.row.status === 0\" type=\"info\">待处理</el-tag>\r\n          <el-tag v-else-if=\"scope.row.status === 1\" type=\"success\">已回复</el-tag>\r\n          <el-tag v-else type=\"info\">已关闭</el-tag>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column prop=\"createTime\" header-align=\"center\" align=\"center\" min-width=\"160\" label=\"提交时间\"></el-table-column>\r\n      <el-table-column fixed=\"right\" header-align=\"center\" align=\"center\" width=\"200\" label=\"操作\">\r\n        <template v-slot=\"scope\">\r\n          <el-button type=\"primary\" size=\"small\" @click=\"handleReply(scope.row)\" v-if=\"scope.row.status === 0\">\r\n            回复\r\n          </el-button>\r\n          <el-button type=\"warning\" size=\"small\" @click=\"handleClose(scope.row.id)\" v-if=\"scope.row.status !== 2\">\r\n            关闭\r\n          </el-button>\r\n          <el-button type=\"danger\" size=\"small\" @click=\"handleDelete(scope.row.id)\">删除</el-button>\r\n        </template>\r\n      </el-table-column>\r\n    </el-table>\r\n\r\n    <el-pagination\r\n        @size-change=\"sizeChangeHandle\"\r\n        @current-change=\"currentChangeHandle\"\r\n        :current-page=\"current\"\r\n        :page-sizes=\"[10, 20, 50, 100]\"\r\n        :page-size=\"pageSize\"\r\n        :total=\"totalPage\"\r\n        layout=\"total, sizes, prev, pager, next, jumper\">\r\n    </el-pagination>\r\n\r\n    <!-- 回复对话框 -->\r\n    <el-dialog title=\"回复\" :visible.sync=\"replyDialogVisible\" width=\"600px\" @close=\"resetReplyForm\">\r\n      <div style=\"margin-bottom: 15px;\">\r\n        <p><strong>学生：</strong>{{ currentFeedback.student ? currentFeedback.student.studentName : '' }}</p>\r\n        <p><strong>标题：</strong>{{ currentFeedback.title }}</p>\r\n        <p><strong>内容：</strong>{{ currentFeedback.content }}</p>\r\n      </div>\r\n      <el-form :model=\"replyForm\" :rules=\"replyFormRules\" ref=\"replyForm\" label-width=\"80px\">\r\n        <el-form-item label=\"回复内容\" prop=\"reply\">\r\n          <el-input type=\"textarea\" v-model=\"replyForm.reply\" placeholder=\"请输入回复内容\" :rows=\"5\"></el-input>\r\n        </el-form-item>\r\n      </el-form>\r\n      <div slot=\"footer\">\r\n        <el-button @click=\"replyDialogVisible = false\">取消</el-button>\r\n        <el-button type=\"primary\" @click=\"submitReply\">确定</el-button>\r\n      </div>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport request from \"@/utils/request\";\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      dataList: [],\r\n      current: 1,\r\n      pageSize: 10,\r\n      totalPage: 0,\r\n      dataListLoading: false,\r\n      query: {\r\n        studentNumber: '',\r\n        type: null,\r\n        status: null,\r\n        dateRange: null\r\n      },\r\n      replyDialogVisible: false,\r\n      currentFeedback: {},\r\n      replyForm: {\r\n        reply: ''\r\n      },\r\n      replyFormRules: {\r\n        reply: [{required: true, message: '请输入回复内容', trigger: 'blur'}]\r\n      }\r\n    };\r\n  },\r\n  methods: {\r\n    getDataList() {\r\n      this.dataListLoading = true;\r\n      const params = {\r\n        pageNum: this.current,\r\n        pageSize: this.pageSize,\r\n      };\r\n\r\n      if (this.query.studentNumber) {\r\n        params.studentNumber = this.query.studentNumber;\r\n      }\r\n      if (this.query.type !== null && this.query.type !== '') {\r\n        params.type = this.query.type;\r\n      }\r\n      if (this.query.status !== null && this.query.status !== '') {\r\n        params.status = this.query.status;\r\n      }\r\n      if (this.query.dateRange && this.query.dateRange.length === 2) {\r\n        params.startDate = this.query.dateRange[0];\r\n        params.endDate = this.query.dateRange[1];\r\n      }\r\n\r\n      request.get('/feedback/page', {params}).then((resp) => {\r\n        if (resp.code === 200) {\r\n          this.dataList = resp.data.list;\r\n          this.totalPage = resp.data.total;\r\n        } else {\r\n          this.dataList = [];\r\n          this.$message.error(resp.message || '获取数据失败');\r\n        }\r\n        this.dataListLoading = false;\r\n      }).catch(err => {\r\n        console.error('获取反馈错误:', err);\r\n        this.dataList = [];\r\n        this.dataListLoading = false;\r\n        this.$message.error('获取数据失败，请稍后重试');\r\n      });\r\n    },\r\n    resetSearch() {\r\n      this.query = {\r\n        studentNumber: '',\r\n        type: null,\r\n        status: null,\r\n        dateRange: null\r\n      };\r\n      this.current = 1;\r\n      this.getDataList();\r\n    },\r\n    sizeChangeHandle(val) {\r\n      this.pageSize = val;\r\n      this.current = 1;\r\n      this.getDataList();\r\n    },\r\n    currentChangeHandle(val) {\r\n      this.current = val;\r\n      this.getDataList();\r\n    },\r\n    handleReply(row) {\r\n      this.currentFeedback = row;\r\n      this.replyDialogVisible = true;\r\n    },\r\n    resetReplyForm() {\r\n      this.$refs.replyForm.resetFields();\r\n      this.currentFeedback = {};\r\n    },\r\n    submitReply() {\r\n      this.$refs.replyForm.validate(valid => {\r\n        if (valid) {\r\n          request.post('/feedback/reply', {\r\n            id: this.currentFeedback.id,\r\n            reply: this.replyForm.reply,\r\n            adminId: JSON.parse(localStorage.getItem(\"user\")).id\r\n          }).then(resp => {\r\n            if (resp.code === 200) {\r\n              this.$message.success('回复成功');\r\n              this.replyDialogVisible = false;\r\n              this.getDataList();\r\n            } else {\r\n              this.$message.error(resp.message || '回复失败');\r\n            }\r\n          });\r\n        }\r\n      });\r\n    },\r\n    handleClose(id) {\r\n      this.$confirm('确认关闭该反馈?', '提示', {\r\n        confirmButtonText: '确定',\r\n        cancelButtonText: '取消',\r\n        type: 'warning'\r\n      }).then(() => {\r\n        request.put(`/feedback/close/${id}`).then(resp => {\r\n          if (resp.code === 200) {\r\n            this.$message.success('关闭成功');\r\n            this.getDataList();\r\n          } else {\r\n            this.$message.error(resp.message || '关闭失败');\r\n          }\r\n        });\r\n      }).catch(() => {});\r\n    },\r\n    handleDelete(id) {\r\n      this.$confirm('确认删除该记录?', '提示', {\r\n        confirmButtonText: '确定',\r\n        cancelButtonText: '取消',\r\n        type: 'warning'\r\n      }).then(() => {\r\n        request.delete(`/feedback/delete/${id}`).then(resp => {\r\n          if (resp.code === 200) {\r\n            this.$message.success('删除成功');\r\n            this.getDataList();\r\n          } else {\r\n            this.$message.error(resp.message || '删除失败');\r\n          }\r\n        });\r\n      }).catch(() => {});\r\n    }\r\n  },\r\n  created() {\r\n    this.getDataList();\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.container {\r\n  padding: 20px;\r\n}\r\n\r\n.search-bar {\r\n  margin-bottom: 20px;\r\n}\r\n</style>\r\n"]},"metadata":{},"sourceType":"module"}